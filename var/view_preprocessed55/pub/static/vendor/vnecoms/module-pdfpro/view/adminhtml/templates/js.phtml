<?php /** * @var $block Vnecoms\PdfPro\Block\Js */ ?> <?php $currentTemplate = ''; if($template = $block->getCurrentTemplate()) { $currentTemplate = $template->getSku(); } ?> <script>
    require([
        "jquery",
        "mage/adminhtml/events",
        "wysiwygAdapter",
        "Vnecoms_PdfPro/js/popular"
    ], function (jQuery, _events, tinyMCE) {
        var config = {
            'vesDefaultLogoUrl': '<?php echo $block->getLogoUrl() ?>',
            'vesDefaultBarcode': '<?php echo $block->getBarCodeImageUrl() ?>',
            'currentTemplate': '<?php echo $currentTemplate ?>'
        };

        var RELATIVE_PATH = '/ves_pdfpro/logos/';

        varienGlobalEvents.attachEventHandler("tinymceBeforeSetContent", function(o){
          
            /*encode*/
            var content = o.content;
           
            content = vesReplace(/{{var MY_LOGO}}/gi,"<img class=\"easypdf-logo\" src=\""+config.vesDefaultLogoUrl+"\" alt=\"\" />",content);
            
            
            o.content = content;
        });

        varienGlobalEvents.attachEventHandler("tinymceSaveContent", function(o){
             console.log('tinymceSaveContent');
            /*Decode*/
            var content = o.content;
            content = vesReplace(/<img class="easypdf-logo" src="(.*?)" alt="" \/>/gi,"{{var MY_LOGO}}",content);
            
            
            o.content = content;
        });

        varienGlobalEvents.attachEventHandler("tinymceExecCommand", function(l){
          
            tinyMCE.editors.each(function(vesEditor){
                if(!vesEditor.dom.hasClass(vesEditor.dom.select('body'),config.currentTemplate)){
                    vesEditor.dom.addClass(vesEditor.dom.select('body'), config.currentTemplate);
                }
            });
        });
    });</script>