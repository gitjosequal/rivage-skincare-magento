<?php /** * Copyright Â© Magento, Inc. All rights reserved. * See COPYING.txt for license details. */ ?> <?php /** @var $block \Magento\Framework\View\Element\Template */ /** @var $helper \Magento\Search\Helper\Data */ $helper = $this->helper(\Magento\Search\Helper\Data::class); ?> <div class="block block-search"><div class="container"><div class="block block-title"><strong><?= /* @escapeNotVerified */ __('Search') ?></strong></div><div class="block block-content"><form class="form minisearch" id="search_mini_form" action="<?= /* @escapeNotVerified */ $helper->getResultUrl() ?>" method="get"><div class="field search"><label class="label" for="search" data-role="minisearch-label"><span><?= /* @escapeNotVerified */ __('Search') ?></span></label> <div class="control"><div id="searchCategories" class="d-none"><select> <option value="all">All</option><?php foreach($this->getCategories() as $category){ ?> <option value="<?php echo $category->getId(); ?>"><?php echo $category->getName(); ?></option><?php } ?></select></div><input id="search" type="text" name="<?= /* @escapeNotVerified */ $helper->getQueryParamName() ?>" value="<?= /* @escapeNotVerified */ $helper->getEscapedQueryText() ?>" placeholder="<?= /* @escapeNotVerified */ __('Search entire store here...') ?>" class="input-text" maxlength="<?= /* @escapeNotVerified */ $helper->getMaxQueryLength() ?>" autocomplete="off"/></div></div><div class="actions"><button type="submit" title="<?= $block->escapeHtml(__('Search')) ?>" class="action search"><span><?= /* @escapeNotVerified */ __('Search') ?></span></button></div></form><?php echo $this->getLayout() ->createBlock('Magento\Cms\Block\Block') ->setBlockId('popular-searches') ->toHtml(); ?></div></div></div><script type="text/javascript">
require(['jquery', 'domReady!'], function($){
	var searchControlElement = $('#search_mini_form .field.search .control').first();
	searchControlElement.append('<div id="searchAutocomplete" style="display:none;"><ul class="row"></ul><button type="submit"><?= /* @escapeNotVerified */ __('View All Results') ?></button></div>');
	$('#search_autocomplete').remove();
	$('#search').unbind();
	$(window).click(function() {
		$('#searchAutocomplete').hide();
	});
	$('.block.block-search').click(function(event){
	    event.stopPropagation();
	});
	$('#search').bind('input', function(){
  		var searchInput = $(this);
	  	var searchInputValue = searchInput.val().replace("/^[a-zA-Z0-9 _-]+$/i", "");
	  	if(searchInputValue.length >=3){
	  		url = "<?php echo $this->getAjaxUrl(); ?>";
	  		$.ajax({
	           	type: "POST",
	           	url: url,
	           	data: {query: searchInputValue, category: $('#searchCategories select').first().val()},
	           	success: function(data){
	           		var searchResultHtml = '';
	           		var size = Object.keys(data).length;
	           		for(let i=1; i<=size; i++){
	           			searchResultHtml += '<li class="col-12 col-md-6" data-url="'+data[i]['url']+'">';
	           			searchResultHtml += '<div class="sa-image"><img src="'+data[i]['thumbnail']+'"></div>';
	           			searchResultHtml += '<div class="sa-prop">';
		           			searchResultHtml += '<div class="sa-title"><p>'+data[i]['name']+'</p></div>';
		           			if(data[i]['rating']){
		           				searchResultHtml += '<div class="sa-rating"><div class="rating-summary"><div class="rating-result" title="'+data[i]['rating']+'%"><span style="width:'+data[i]['rating']+'%"><span>'+data[i]['rating']+'%</span></span></div></div></div>';
		           			}
		           			searchResultHtml += '<div class="sa-price"><p>'+data[i]['price']+'<p></div>';
		           		searchResultHtml += '</div>';
	           			searchResultHtml += '</li>';
	           			$('#searchAutocomplete ul').first().html(searchResultHtml);
	           		}
	           		$( "#searchAutocomplete ul li" ).on( "click", function() {
				  		window.location = $(this).data('url');
					});
	           		if(size > 0){
	           			$('#searchAutocomplete').show();
					}else{
						$('#searchAutocomplete').hide();
					}
				},
	            error: function (data) {
	                console.log(data);
	            }
	  		});
	  	}else{
	  		$('#searchAutocomplete').hide();
	  	}
	});
	$("#search").on("focus", function(){
    	var searchInput = $(this);
	  	var searchInputValue = searchInput.val().replace("/^[a-zA-Z0-9 _-]+$/i", "");
	  	if(searchInputValue.length >=3){
	  		url = "<?php echo $this->getAjaxUrl(); ?>";
	  		$.ajax({
	           	type: "POST",
	           	url: url,
	           	data: {query: searchInputValue, category: $('#searchCategories select').first().val()},
	           	success: function(data){
	           		console.log(data);
	           		var searchResultHtml = '';
	           		var size = Object.keys(data).length;
	           		for(let i=1; i<=size; i++){
	           			searchResultHtml += '<li class="col-12 col-md-6" data-url="'+data[i]['url']+'">';
	           			searchResultHtml += '<div class="sa-image"><img src="'+data[i]['thumbnail']+'"></div>';
	           			searchResultHtml += '<div class="sa-prop">';
		           			searchResultHtml += '<div class="sa-title"><p>'+data[i]['name']+'</p></div>';
		           			if(data[i]['rating']){
		           				searchResultHtml += '<div class="sa-rating"><div class="rating-summary"><div class="rating-result" title="'+data[i]['rating']+'%"><span style="width:'+data[i]['rating']+'%"><span>'+data[i]['rating']+'%</span></span></div></div></div>';
		           			}
		           			searchResultHtml += '<div class="sa-price"><p>'+data[i]['price']+'<p></div>';
		           		searchResultHtml += '</div>';
	           			searchResultHtml += '</li>';
	           			$('#searchAutocomplete ul').first().html(searchResultHtml);
	           		}
	           		if(size > 0){
	           			$('#searchAutocomplete').show();
					}else{
						$('#searchAutocomplete').hide();
					}
					$( "#searchAutocomplete ul li" ).on( "click", function() {
				  		window.location = $(this).data('url');
					});
				},
	            error: function (data) {
	                console.log(data);
	            }
	  		});
	  	}else{
	  		$('#searchAutocomplete').hide();
	  	}
	});
	$("#searchCategories select").first().on("change", function(){
		var searchInput = $('#search');
	  	var searchInputValue = searchInput.val().replace("/^[a-zA-Z0-9 _-]+$/i", "");
	  	if(searchInputValue.length >=3){
	  		url = "<?php echo $this->getAjaxUrl(); ?>";
	  		$.ajax({
	           	type: "POST",
	           	url: url,
	           	data: {query: searchInputValue, category: $('#searchCategories select').first().val()},
	           	success: function(data){
	           		console.log(data);
	           		var searchResultHtml = '';
	           		var size = Object.keys(data).length;
	           		for(let i=1; i<=size; i++){
	           			searchResultHtml += '<li class="col-12 col-md-6" data-url="'+data[i]['url']+'">';
	           			searchResultHtml += '<div class="sa-image"><img src="'+data[i]['thumbnail']+'"></div>';
	           			searchResultHtml += '<div class="sa-prop">';
		           			searchResultHtml += '<div class="sa-title"><p>'+data[i]['name']+'</p></div>';
		           			if(data[i]['rating']){
		           				searchResultHtml += '<div class="sa-rating"><div class="rating-summary"><div class="rating-result" title="'+data[i]['rating']+'%"><span style="width:'+data[i]['rating']+'%"><span>'+data[i]['rating']+'%</span></span></div></div></div>';
		           			}
		           			searchResultHtml += '<div class="sa-price"><p>'+data[i]['price']+'<p></div>';
		           		searchResultHtml += '</div>';
	           			searchResultHtml += '</li>';
	           			$('#searchAutocomplete ul').first().html(searchResultHtml);
	           		}
	           		if(size > 0){
	           			$('#searchAutocomplete').show();
					}else{
						$('#searchAutocomplete').hide();
					}
					$( "#searchAutocomplete ul li" ).on( "click", function() {
				  		window.location = $(this).data('url');
					});
				},
	            error: function (data) {
	                console.log(data);
	            }
	  		});
	  	}else{
	  		$('#searchAutocomplete').hide();
	  	}
	});
});</script><style type="text/css"> #searchCategories { display: inline-block; float: left; width: 30%; } #search { display: inline-block; position: relative; left: unset; width: 70%; float: right; } .block-search { } #searchAutocomplete { position: absolute; top: 45px; border: 1px solid #ba9765; background-color: white; width: 100%; overflow-y: scroll; } #searchAutocomplete::-webkit-scrollbar { width: 5px; } #searchAutocomplete::-webkit-scrollbar-track { box-shadow: transparent } #searchAutocomplete::-webkit-scrollbar-thumb { background-color: #b99765; } #searchAutocomplete button { margin: 10px; border: 2px solid #000 !important; color: #000 !important; font-weight: 600; background-color: transparent !important; padding: 8px 30px !important; border-radius: 0 !important; box-sizing: border-box; } #searchAutocomplete button:hover { border: 2px solid #ba9765 !important; color: #ba9765 !important; background-color: transparent !important; } #searchAutocomplete ul { margin: 0; padding: 5px; list-style: none; } #searchAutocomplete ul li { padding: 4px; margin: 0; cursor: pointer; } #searchAutocomplete ul li:hover { border: 1px solid #ba9765; } #searchAutocomplete .sa-image { display: inline-block; max-width: 30%; height: 110px; } #searchAutocomplete .sa-rating { margin-top: 10px; } #searchAutocomplete .sa-prop { display: inline-block; width: 70%; float: right; } #searchAutocomplete .sa-title { margin-top: 10px; } #searchAutocomplete .sa-price { margin-top: 10px; padding: 10px; } @media all and (min-width: 768px), print { .block-search { width: 400px; padding-left: 0; } } @media (max-width: 767px) { #searchAutocomplete { top: 60px; max-height: 400px } }</style>